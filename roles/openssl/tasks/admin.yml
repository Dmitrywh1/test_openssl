- name: Generate root CA private key
  openssl_privatekey:
    path: "{{ openssl.admin.private_key_temp }}"
    size: 2048
    type: RSA

- name: Generate PKCS#12 file
  community.crypto.openssl_pkcs12:
    action: export
    path: "{{ openssl.admin.private_key }}"
    friendly_name: admin
    privatekey_path: "{{ openssl.admin.private_key_temp }}"
    state: present
    mode: "777"

- name: create | Create ssl csr
  community.crypto.openssl_csr:
    path: "{{ openssl.admin.csr }}"
    privatekey_path: "{{ openssl.admin.private_key }}"
    mode: "777"

- name: Generate root CA certificate
  community.crypto.x509_certificate:
    path: "{{ openssl.admin.cert }}"
    privatekey_path: "{{ openssl.admin.private_key }}"
#    selfsigned_not_after: 730d
    provider: selfsigned

